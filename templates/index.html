{% extends "base.html" %}

{% block content %}

	{% if not classzy %}
		{% if not adding_warning %}
			<div data-role="page" id="search">

				<div data-role="content">
		
					<h1 id="title" class="fancy">Classzy</h1>
		
					{% if warning %}
						<p class="warning">{{warning}}</p>
					{% endif %}
		
					<form action="/" method="post" data-ajax="false" id="search_form">{% csrf_token %}
						<div data-role="fieldcontain" style="margin-top:-20px">
							<input type="search" name="class" value="" id="search_box"/>
							<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Search</button>
						</div>
					</form>
			
					{% if not warning %}
						<p>Examples: <a href="#" onTouchStart="document.getElementById('search_box').value = 'CS 107'; document.getElementById('search_form').submit();">CS 107</a>, <a href="#" onTouchStart="document.getElementById('search_box').value = 'CS 147'; document.getElementById('search_form').submit();">CS 147</a>, <a href="#" onTouchStart="document.getElementById('search_box').value = 'Math 51'; document.getElementById('search_form').submit();">Math 51</a></p>
					{% else %}
						<p>Missing Class? <a href="#add_class">Add it</a></p>
					{% endif %}
				
					<p class="fancy tagline">The info you <em>want</em> to know about your classes</p>
	
				</div>
			</div>
		{% endif %}
		
		<div data-role="page" id="add_class">
		
			<div data-role="header">
				<a href="#search" data-icon="delete" data-direction="reverse">Cancel</a>
				<h1 class="ui-title">Add Class</h1>
			</div>
		
			<div data-role="content">
			
				{% if adding_warning %}
					<p class="warning">{{adding_warning}}</p>
				{% endif %}
			
				<form action="/" method="post" data-ajax="false" >{% csrf_token %}
					<div data-role="fieldcontain">
						<label for="class_code">Class Code</label>
						<input type="text" name="class_code" value="{{error_class}}" id="class_code"/>
					
						<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Add Class</button>
					</div>
				</form>

			</div>
		</div>	
	{% endif %}
	
	<div data-role="page" id="class">
		
		<div data-role="header">
			<a href="#search" data-direction="reverse">Search</a>
			<h1 class="ui-title">{{classzy.code}}</h1>
			<a href="#edit" data-icon="gear" class="ui-btn-right">Info</a>
		</div>
				
		<div data-role="content" id="main">
	
			{% if updated %}
				<p class="warning">Updated</p>
			{% endif %}
			{% if added %}
				<p class="warning">Assignment added</p>
			{% endif %}
			{% if warning %}
				<p class="warning">{{warning}}</p>
			{% endif %}
	
			<h1 id="class" class="fancy">{{classzy.code}}{% if classzy.name %} - {{classzy.name}}{% endif %}</h1>
			<div data-role="fieldcontain">
				{% if assignments %}
					{% for a in assignments %}
				
						<div data-role="collapsible" data-theme="d" data-collapsed="true">
							<h1>{{a.name}} ({% if a.homework %}HW{% else %}Test{% endif %})</h1>
							<h3 class="no_margin">Due: {{a.due_date}}</h3>
							
							<div class="ratings">
								{% for i in total_ratings %}
									{% if i == a.avg_rating %}
										<input name="{{a.name}}_{{a.due_date}}" type="radio" class="star" disabled="disabled" checked="checked"/>
									{% else %}
										<input name="{{a.name}}_{{a.due_date}}" type="radio" class="star" disabled="disabled"/>
									{% endif %}
								{% endfor %}
								<p>{{a.num_ratings}} Difficulty Rating{% if a.num_ratings != 1 %}s{% endif %}</p>
							</div>
							
							{% if a.latest_comment_text %}
								<div class="comment no_margin">
									<p><strong>{{a.latest_comment_name}}</strong> - {{a.latest_comment_text}}</p>
								</div>
							{% endif %}
							
							<a href="#more_assignment_info_difficulty_{{a.name}}_{{a.due_date}}" data-role="button" data-icon="plus" data-theme="b" id="add_button">Detailed Info</a>
						</div>
				
					{% endfor %}
				{% else %}
					<div data-role="collapsible" data-theme="d" data-collapsed="true">
						<h1>No Assignments Yet</h1>
						<img src="/static/img/funny.gif" alt="I have done nothing productive all day" width=280/>
					</div>
				{% endif %}
			</div>
			
			<a href="#add_assignment" data-role="button" data-icon="star" data-theme="b" id="add_button">Add Assignment</a>

		</div>
		
		
		<div data-role="footer"> 
			<h4>Total Views: {{classzy.views}}</h4> 
		</div>
	</div>
	
	
	<div data-role="page" id="edit">

		<div data-role="header">
			<a data-rel="back">Back</a>
			<h1 class="ui-title">{{classzy.code}}</h1>
		</div>

		<div data-role="content">

			<h1 style="margin-bottom:0">{{classzy.code}}</h1>
			<form action="/" method="post" data-ajax="false" >{% csrf_token %}
				<div data-role="fieldcontain">
					<label for="edit_class_name">Full Class Name</label>
					<input type="text" name="edit_class_name" value="{% if classzy.name %}{{classzy.name}}{% endif %}" id="edit_class_name"/>
					<label for="edit_class_professor">Professor</label>
					<input type="text" name="edit_class_professor" value="{% if classzy.professor %}{{classzy.professor}}{% endif %}" id="edit_class_professor"/>
				
					<input type="hidden" name="edit_class_code" value="{{classzy.code}}"/>
					<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Save Info</button>
				</div>
			</form>
			

		</div>
	</div>
	
	<div data-role="page" id="add_assignment">

		<div data-role="header">
			<a data-rel="back">Back</a>
			<h1 class="ui-title">{{classzy.code}}</h1>
		</div>

		<div data-role="content">

			<h1>Add Assignment</h1>
			<form action="/" method="post" data-ajax="false" style="margin-top:-20px;">{% csrf_token %}
				<div data-role="fieldcontain">
					<label for="add_assignment_name">Assignment</label>
					<input type="text" name="add_assignment_name" value="" id="add_assignment_name" placeholder="Assignment" /><br/>
					
					<label for="add_assignment_due_date">Due Date</label>
					<input type="date" name="add_assignment_due_date" value="" id="add_assignment_due_date"/>
					
					<fieldset data-role="controlgroup" data-type="horizontal" style="margin-bottom:0">
						<legend>Type</legend>
						<input type="radio" name="add_assignment_type" id="homework" value="homework" />
						<label for="homework" class="assign_type">Homework</label>
						
						<input type="radio" name="add_assignment_type" id="test" value="test" />
						<label for="test" class="assign_type">Test</label>
					</fieldset>
					
					<div data-role="fieldcontain">
						<label for="add_assignment_rating">Difficulty</label>
					 	<input type="range" name="add_assignment_rating" id="add_assignment_rating" value="0" min="0" max="5"  />
					</div>
					
					<input type="hidden" name="add_assignment_classzy" value="{{classzy.key}}">
					<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Add Assignment</button>
				</div>
			</form>
			

		</div>
	</div>
	
	{% if assignments %}
		{% for a in assignments %}
			<div data-role="page" id="more_assignment_info_difficulty_{{a.name}}_{{a.due_date}}">

				<div data-role="header">
					<a href="#class" data-direction="reverse">Back</a>
					<h1 class="ui-title">{{classzy.code}} - {{a.name}}</h1>
					<div data-role="navbar">
						<ul>
							<li><a href="#more_assignment_info_difficulty_{{a.name}}_{{a.due_date}}" class="ui-btn-active">Difficulty</a></li>
							<li><a href="#more_assignment_info_time_{{a.name}}_{{a.due_date}}">Time</a></li>
							<li><a href="#more_assignment_info_comments_{{a.name}}_{{a.due_date}}">Comments</a></li>
						</ul>
					</div>
				</div>

				<div data-role="content">

					<h1>Difficulty</h1>
					<div class="ratings">
						{% for i in total_ratings %}
							{% if i == a.avg_rating %}
								<input name="edit_{{a.name}}_{{a.due_date}}" type="radio" class="star" disabled="disabled" checked="checked"/>
							{% else %}
								<input name="edit_{{a.name}}_{{a.due_date}}" type="radio" class="star" disabled="disabled"/>
							{% endif %}
						{% endfor %}
						<p>{{a.num_ratings}} Difficulty Rating{% if a.num_ratings != 1 %}s{% endif %}</p>
					</div>
					
					<form action="/" method="post" data-ajax="false" >{% csrf_token %}
						<h3 class="no_margin">How hard was {{a.name}} for you?</h3>
						<div data-role="fieldcontain">
							<label for="add_assignment_rating">Difficulty</label>
						 	<input type="range" name="add_assignment_rating" id="add_assignment_rating" value="0" min="0" max="5"  />
						</div>
						<input type="hidden" name="hidden_classzy" value="{{classzy.key}}"/>
						<input type="hidden" name="add_assignment_difficulty_name" value="{{a.name}}"/>
						<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Add Rating</button>
					</form>
				</div>
			</div>
			<div data-role="page" id="more_assignment_info_time_{{a.name}}_{{a.due_date}}">

				<div data-role="header">
					<a data-rel="back">Back</a>
					<h1 class="ui-title">{{classzy.code}} - {{a.name}}</h1>
					<div data-role="navbar">
						<ul>
							<li><a href="#more_assignment_info_difficulty_{{a.name}}_{{a.due_date}}">Difficulty</a></li>
							<li><a href="#more_assignment_info_time_{{a.name}}_{{a.due_date}}">Time</a></li>
							<li><a href="#more_assignment_info_comments_{{a.name}}_{{a.due_date}}" class="ui-btn-active">Comments</a></li>
						</ul>
					</div>
				</div>

				<div data-role="content">

					<h1>Time</h1>
					
					<form action="/" method="post" data-ajax="false" >{% csrf_token %}
						<h3 class="no_margin">How many hours did it take you to finish {{a.name}}?</h3>
						<div data-role="fieldcontain">
							<label for="add_assignment_time">Difficulty</label>
						 	<input type="range" name="add_assignment_time" id="add_assignment_time" value="0" min="0" max="40"  />
						</div>
						<input type="hidden" name="hidden_classzy" value="{{classzy.key}}"/>
						<input type="hidden" name="add_assignment_time_name" value="{{a.name}}"/>
						<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Submit Time</button>
					</form>
				</div>
			</div>
			<div data-role="page" id="more_assignment_info_comments_{{a.name}}_{{a.due_date}}">

				<div data-role="header">
					<a href="#class" data-direction="reverse">Back</a>
					<h1 class="ui-title">{{classzy.code}} - {{a.name}}</h1>
					<div data-role="navbar">
						<ul>
							<li><a href="#more_assignment_info_difficulty_{{a.name}}_{{a.due_date}}">Difficulty</a></li>
							<li><a href="#more_assignment_info_time_{{a.name}}_{{a.due_date}}">Time</a></li>
							<li><a href="#more_assignment_info_comments_{{a.name}}_{{a.due_date}}" class="ui-btn-active">Comments</a></li>
						</ul>
					</div>
				</div>

				<div data-role="content">

					<h1>Comments</h1>
					
					{% for comment in a.comments.all %}
						<div class="comment no_margin">
							<p><strong>{{comment.name}}</strong> - {{comment.comment}}</p>
						</div>
					{% endfor %}
					
					<form action="/" method="post" data-ajax="false" >{% csrf_token %}
						<h3 class="no_margin">Leave a tip</h3>
						<div data-role="fieldcontain">
							<label for="comment_name">Name</label>
							<input type="text" name="comment_name" value="" id="comment_name"/>
							<label for="comment_text">Comment</label>
							<textarea cols="40" rows="8" name="comment_text" id="comment_text"></textarea>
							
							<input type="hidden" name="hidden_classzy" value="{{classzy.key}}"/>
							<input type="hidden" name="add_assignment_comment_name" value="{{a.name}}"/>
							<button type="submit" data-theme="b" class="ui-btn-hidden" aria-disabled="false">Add Comment</button>
						</div>
					</form>
				</div>
			</div>
	
		{% endfor %}
	{% endif %}
	
{% endblock %}